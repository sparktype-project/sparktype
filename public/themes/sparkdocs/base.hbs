<!DOCTYPE html>
<html lang="en">
<head>
  {{> head headContext}}
</head>
<body class="min-h-screentext-text bg-background"
      x-data="{
        sidebarOpen: window.innerWidth >= 768,
        expandedSections: [],
        currentPath: window.location.pathname,
        init() {
          window.addEventListener('resize', () => {
            this.sidebarOpen = window.innerWidth >= 768;
          });
        },
        toggleSection(id) {
          if (this.expandedSections.includes(id)) {
            this.expandedSections = this.expandedSections.filter(item => item !== id);
          } else {
            this.expandedSections.push(id);
          }
        },
        // Normalize URL for consistent comparison
        normalizeUrl: function(url) {
          if (!url) return '/';
          var cleaned = url.replace(/^\.\//, '/');
          cleaned = cleaned.replace(/\/index\.html$/, '/');
          cleaned = cleaned.replace(/\/$/, '') || '/';
          return cleaned;
        },
        // Check if a navigation href is active (matches current page)
        isActive: function(href) {
          if (!href) return false;
          var cleanHref = this.normalizeUrl(href);
          var cleanCurrent = this.normalizeUrl(this.currentPath);
          return cleanHref === cleanCurrent;
        },
        // Auto-expand all sections by default
        autoExpandSections: function() {
          this.expandedSections = [];
          {{#each navLinks}}
            {{#if this.children}}
              this.expandedSections.push('{{@index}}');
            {{/if}}
          {{/each}}
        }
      }"
      x-init="autoExpandSections()">

  {{> header}}

  {{!-- Unified Layout: Flex on mobile, Grid on desktop --}}
  <div class="flex flex-col md:grid md:grid-areas-sidebar-main min-h-screen" style="grid-template-columns: var(--sidebar-width) 1fr;">
    {{!-- Sidebar --}}
    {{> sidebar}}

    {{!-- Main Content --}}
    <div class="flex flex-col flex-1 md:grid-area-main">
      {{!-- Page Content --}}
      <main class="flex-1">
        {{#if contentFile.frontmatter.banner_image}}
            <div class="">
                {{{image fieldname="banner_image" class="w-full h-72 cover bg-center" alt=contentFile.frontmatter.title}}}
            </div>
        {{/if}}
          {{{body}}}
        </div>
        
      </main>

      {{!-- Footer --}}
      {{> footer}}
    </div>
  </div>

  {{!-- Mobile Sidebar Overlay --}}
  {{!-- Backdrop --}}
  <div class="md:hidden fixed inset-0 bg-black opacity-80 backdrop-blur z-40 transition-opacity"
       x-show="sidebarOpen && window.innerWidth < 768"
       @click="sidebarOpen = false"
       x-transition:enter="transition-opacity ease-out duration-300"
       x-transition:enter-start="opacity-0"
       x-transition:enter-end="opacity-100"
       x-transition:leave="transition-opacity ease-in duration-200"
       x-transition:leave-start="opacity-100"
       x-transition:leave-end="opacity-0">
  </div>



  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</body>
</html>