<!DOCTYPE html>
<html lang="en">
<head>
  {{> head headContext}}
</head>
<body class="min-h-screen text-text bg-background"
      x-data="{
        sidebarOpen: false,
        expandedSections: [],
        currentPath: window.location.pathname,
        toggleSection(id) {
          if (this.expandedSections.includes(id)) {
            this.expandedSections = this.expandedSections.filter(item => item !== id);
          } else {
            this.expandedSections.push(id);
          }
        },
        normalizeUrl: function(url) {
          if (!url) return '/';
          var cleaned = url.replace(/^\.\//, '/');
          cleaned = cleaned.replace(/\/index\.html$/, '/');
          cleaned = cleaned.replace(/\/$/, '') || '/';
          return cleaned;
        },
        isActive: function(href) {
          if (!href) return false;
          var cleanHref = this.normalizeUrl(href);
          var cleanCurrent = this.normalizeUrl(this.currentPath);
          return cleanHref === cleanCurrent;
        },
        autoExpandSections: function() {
          this.expandedSections = [];
          {{#each navLinks}}
            {{#if this.children}}
              this.expandedSections.push('{{@index}}');
            {{/if}}
          {{/each}}
        }
      }"
      x-init="autoExpandSections()">

  {{!-- Sidebar --}}
  {{> sidebar}}

  {{!-- Main Content Area with offset for sidebar --}}
  <div class="flex flex-col min-h-screen md:ml-64">
    {{> header}}

    <main class="flex-1 p-6">
      {{#if contentFile.frontmatter.banner_image}}
        <div class="mb-6">
          {{{image fieldname="banner_image" class="w-full h-72 object-cover rounded-lg" alt=contentFile.frontmatter.title}}}
        </div>
      {{/if}}
      {{{body}}}
    </main>

    {{> footer}}
  </div>

  {{!-- Mobile Sidebar Backdrop --}}
  <div class="md:hidden fixed inset-0 bg-black/50 backdrop-blur-lg z-40"
       x-show="sidebarOpen"
       @click="sidebarOpen = false"
       x-transition:enter="transition-opacity ease-out duration-300"
       x-transition:enter-start="opacity-0"
       x-transition:enter-end="opacity-100"
       x-transition:leave="transition-opacity ease-in duration-200"
       x-transition:leave-start="opacity-100"
       x-transition:leave-end="opacity-0">
  </div>

  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</body>
</html>