<!DOCTYPE html>
<html lang="en">
<head>
  {{> head headContext}}
</head>
<body class="min-h-screentext-text"
      x-data="{
        sidebarOpen: false,
        expandedSections: [],
        currentPath: window.location.pathname,
        toggleSection(id) {
          if (this.expandedSections.includes(id)) {
            this.expandedSections = this.expandedSections.filter(item => item !== id);
          } else {
            this.expandedSections.push(id);
          }
        },
        // Normalize URL for consistent comparison
        normalizeUrl: function(url) {
          if (!url) return '/';
          var cleaned = url.replace(/^\.\//, '/');
          cleaned = cleaned.replace(/\/index\.html$/, '/');
          cleaned = cleaned.replace(/\/$/, '') || '/';
          return cleaned;
        },
        // Check if a navigation href is active (matches current page)
        isActive: function(href) {
          if (!href) return false;
          var cleanHref = this.normalizeUrl(href);
          var cleanCurrent = this.normalizeUrl(this.currentPath);
          return cleanHref === cleanCurrent;
        },
        // Auto-expand all sections by default (disabled - keep collapsed)
        autoExpandSections: function() {
          this.expandedSections = [];
          // Keep all sections collapsed by default
          // {{#each navLinks}}
          //   {{#if this.children}}
          //     this.expandedSections.push('{{@index}}');
          //   {{/if}}
          // {{/each}}
        }
      }"
      x-init="autoExpandSections()">

      {{> header}}

  {{!-- Desktop Layout: Grid with sidebar --}}
  <div class="hidden md:grid md:grid-areas-sidebar-main" style="grid-template-columns: var(--sidebar-width) 1fr; min-height: 100vh;">
    {{!-- Desktop Sidebar --}}
    <aside class="md:grid-area-sidebar bg-sidebar border-r border-border overflow-y-auto">
      {{> sidebar}}
    </aside>

    {{!-- Desktop Main Content --}}
    <div class="md:grid-area-main flex flex-col">
      {{!-- Header --}}
      

      {{!-- Page Content --}}
      <main class="flex-1">
            {{{body}}}
      </main>

      {{!-- Footer --}}
      {{> footer}}
    </div>
  </div>

  {{!-- Mobile Layout: Stacked with overlay sidebar --}}
  <div class="md:hidden flex flex-col min-h-screen">
    {{!-- Mobile Header with Menu Button --}}
    <header class="border-b border-border bg-background sticky top-0 z-30">
      <div class="flex items-center px-4 py-4">
        <button @click="sidebarOpen = true"
                class="p-2 text-heading hover:text-primary transition-colors"
                aria-label="Open navigation">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
        <h1 class="ml-4 text-lg font-semibold text-heading">
          {{#if contentFile.frontmatter.title}}
            {{contentFile.frontmatter.title}}
          {{else}}
            {{manifest.title}}
          {{/if}}
        </h1>
      </div>
    </header>

    {{!-- Mobile Content --}}
    <main class="flex-1">
      <div class="max-w-prose mx-auto px-6 py-8">
        <div class="prose">
          {{{body}}}
        </div>
      </div>
    </main>

    {{!-- Mobile Footer --}}
    {{> footer}}
  </div>

  {{!-- Mobile Sidebar Overlay --}}
  <div class="md:hidden">
    {{!-- Backdrop --}}
    <div class="fixed inset-0 bg-black bg-opacity-50 z-40"
         x-show="sidebarOpen"
         @click="sidebarOpen = false"
         x-transition:enter="transition-opacity ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition-opacity ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0">
    </div>

    {{!-- Slide-out Sidebar --}}
    <aside class="fixed left-0 top-0 bottom-0 w-80 bg-sidebar border-r border-border z-50 overflow-y-auto"
           x-show="sidebarOpen"
           x-transition:enter="transition ease-out duration-300 transform"
           x-transition:enter-start="-translate-x-full"
           x-transition:enter-end="translate-x-0"
           x-transition:leave="transition ease-in duration-200 transform"
           x-transition:leave-start="translate-x-0"
           x-transition:leave-end="-translate-x-full">

      {{!-- Close Button --}}
      <div class="flex items-center justify-between p-6 border-b border-border">
        <a href="{{#if @root.options.isExport}}./{{else}}/{{/if}}"
           class="text-xl font-bold text-heading no-underline">
          {{manifest.title}}
        </a>
        <button @click="sidebarOpen = false"
                class="p-2 text-muted hover:text-heading transition-colors"
                aria-label="Close navigation">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      {{!-- Mobile Navigation --}}
      <nav class="p-4 space-y-1">
        {{#each navLinks}}
          {{#if this.children}}
            {{!-- Section with children --}}
            <div>
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-muted transition-colors">
                <a href="{{this.href}}"
                   class="flex-1 font-medium text-sm text-heading no-underline"
                   :class="isActive('{{this.href}}') ? 'text-primary' : ''"
                   @click="sidebarOpen = false">
                  {{this.label}}
                </a>
                <button class="ml-2 text-muted hover:text-heading transition-all duration-200"
                        :class="expandedSections.includes('{{@index}}') ? 'rotate-90 text-primary' : ''"
                        @click="toggleSection('{{@index}}')">
                  <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 111.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                  </svg>
                </button>
              </div>

              {{!-- Children --}}
              <div class="ml-3 border-l border-border"
                   x-show="expandedSections.includes('{{@index}}')"
                   x-transition:enter="transition ease-out duration-200"
                   x-transition:enter-start="opacity-0"
                   x-transition:enter-end="opacity-100"
                   x-transition:leave="transition ease-in duration-150"
                   x-transition:leave-start="opacity-100"
                   x-transition:leave-end="opacity-0">
                {{#each this.children}}
                  <a href="{{this.href}}"
                     class="block py-1 px-3 ml-3 text-sm text-text no-underline rounded hover:bg-muted hover:text-heading transition-colors"
                     :class="isActive('{{this.href}}') ? 'text-primary font-medium bg-primary bg-opacity-10' : ''"
                     @click="sidebarOpen = false">
                    {{this.label}}
                  </a>
                {{/each}}
              </div>
            </div>
          {{else}}
            {{!-- Single item without children --}}
            <div>
              <a href="{{this.href}}"
                 class="block py-2 px-3 font-medium text-sm text-heading no-underline rounded hover:bg-muted hover:text-primary transition-colors"
                 :class="isActive('{{this.href}}') ? 'text-primary bg-primary bg-opacity-10' : ''"
                 @click="sidebarOpen = false">
                {{this.label}}
              </a>
            </div>
          {{/if}}
        {{/each}}
      </nav>
    </aside>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</body>
</html>